var IllDownData=function(c,b,f,a,e,d){var g=$.param({user:b,passwd:f,filename:a});$.ajax({url:"https://acoustic.ifp.uiuc.edu:8081/gridfs/"+c+"/data?"+g,type:"GET",dataType:"arraybuffer",timeOut:10000,xhrFields:{withCredentials:true}}).done(function(h){console.log("IllDownData "+h.byteLength);e(h)}).fail(function(){console.log("ajax fail");d()})};var IllDownEvent=function(c,b,f,a,e,d){var g=$.param({dbname:c,colname:"event",user:b,passwd:f});$.ajax({url:"https://acoustic.ifp.uiuc.edu:8081/query?"+g,data:'{filename:"'+a+'"}',type:"POST",dataType:"text",timeOut:10000,xhrFields:{withCredentials:true}}).done(function(i){var h=JSON.parse(i);console.log("IllDownEvent "+h[0].filename);e(h)}).fail(function(){console.log("ajax fail");d()})};var IllUpdateEvent=function(c,b,e,a,g,d){var f=$.param({dbname:c,colname:"event",user:b,passwd:e});$.ajax({url:"https://acoustic.ifp.uiuc.edu:8081/write?"+f,data:'{filename:"'+a+'"}\n{$'+g+":"+d+"}",type:"POST",dataType:"text",timeOut:10000,xhrFields:{withCredentials:true}}).done(function(h){console.log("IllUpdateEvent "+h)}).fail(function(){console.log("ajax fail")})};var IllQueryEvent=function(b,a,f,e,d,c){var g={dbname:b,colname:"event",user:a,passwd:f};if(e.hasOwnProperty("limit")){g.limit=e.limit}var h=$.param(g);if(e.hasOwnProperty("t1")&&e.hasOwnProperty("t2")){timeDat='{recordDate:{$gte:{$date:"'+e.t1+'"}, $lte:{$date:"'+e.t2+'"}}}'}else{if(e.hasOwnProperty("t1")){timeDat='{recordDate:{$gte:{$date:"'+e.t1+'"}}}'}else{if(e.hasOwnProperty("t2")){timeDat='{recordDate:{$lte:{$date:"'+e.t2+'"}}}'}}}if(e.hasOwnProperty("f1")&&e.hasOwnProperty("f2")){freqDat=",{minFreq:{$gte:"+e.f1+"}},{maxFreq:{$lte:"+e.f2+"}}"}else{if(e.hasOwnProperty("f1")){freqDat=",{minFreq:{$gte:"+e.f1+"}}"}else{if(e.hasOwnProperty("f2")){freqDat=",{maxFreq:{$lte:"+e.f2+"}}"}else{freqDat=""}}}if(e.hasOwnProperty("dur1")&&e.hasOwnProperty("dur2")){durDat=",{duration:{$gte:"+e.dur1+", $lte:"+e.dur2+"}}"}else{if(e.hasOwnProperty("dur1")){durDat=",{duration:{$gte:"+e.dur1+"}}"}else{if(e.hasOwnProperty("dur2")){durDat=",{duration:{$lte:"+e.dur2+"}}"}else{durDat=""}}}if(e.hasOwnProperty("lnp1")&&e.hasOwnProperty("lnp2")){lnpDat=",{logNoiseProb:{$gte:"+e.lnp1+", $lte:"+e.lnp2+"}}"}else{if(e.hasOwnProperty("lnp1")){lnpDat=",{logNoiseProb:{$gte:"+e.lnp1+"}}"}else{if(e.hasOwnProperty("lnp2")){lnpDat=",{logNoiseProb:{$lte:"+e.lnp2+"}}"}else{lnpDat=""}}}if(e.hasOwnProperty("loc")&&e.hasOwnProperty("rad")){locDat=",{location:{$geoWithin:{$centerSphere:[["+e.loc[1]+","+e.loc[0]+"], "+e.rad+"]}}}"}else{locDat=""}if(e.hasOwnProperty("kw")){kwDat=',{$text: {$search:"'+e.kw+'"}}'}else{kwDat=""}postDat="{$and:["+timeDat+freqDat+durDat+lnpDat+locDat+kwDat+"]}";$.ajax({url:"https://acoustic.ifp.uiuc.edu:8081/query?"+h,data:postDat,type:"POST",dataType:"text",timeOut:10000}).done(function(i){file=JSON.parse(i);d(file)}).fail(function(){console.log("ajax fail");c()})};