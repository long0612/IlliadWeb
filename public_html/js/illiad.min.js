var IllDownData=function(c,b,f,a,e,d){var g=$.param({user:b,passwd:f,filename:a});$.ajax({url:"https://acoustic.ifp.uiuc.edu:8081/gridfs/"+c+"/data?"+g,type:"GET",dataType:"arraybuffer",timeOut:10000,xhrFields:{withCredentials:true}}).done(function(h){console.log("IllDownData "+h.byteLength);e(h)}).fail(function(){console.log("ajax fail");d()})};var IllDownEvent=function(c,b,f,a,e,d){var g=$.param({dbname:c,colname:"event",user:b,passwd:f});$.ajax({url:"https://acoustic.ifp.uiuc.edu:8081/query?"+g,data:'{filename:"'+a+'"}',type:"POST",dataType:"text",timeOut:10000,xhrFields:{withCredentials:true}}).done(function(i){var h=JSON.parse(i);console.log("IllDownEvent "+h[0].filename);e(h)}).fail(function(){console.log("ajax fail");d()})};var IllUpdateEvent=function(c,b,e,a,g,d){var f=$.param({dbname:c,colname:"event",user:b,passwd:e});$.ajax({url:"https://acoustic.ifp.uiuc.edu:8081/write?"+f,data:'{filename:"'+a+'"}\n{$'+g+":"+d+"}",type:"POST",dataType:"text",timeOut:10000,xhrFields:{withCredentials:true}}).done(function(h){console.log("IllUpdateEvent "+h)}).fail(function(){console.log("ajax fail")})};var IllQueryEvent=function(i,d,e,b,h,f){var g=3959;var c={dbname:i,colname:"event",user:d,passwd:e};if(b.hasOwnProperty("limit")){c.limit=b.limit}var a=$.param(c);if(b.hasOwnProperty("t1")&&b.hasOwnProperty("t2")){timeDat='{recordDate:{$gte:{$date:"'+b.t1+'"}, $lte:{$date:"'+b.t2+'"}}}'}else{if(b.hasOwnProperty("t1")){timeDat='{recordDate:{$gte:{$date:"'+b.t1+'"}}}'}else{if(b.hasOwnProperty("t2")){timeDat='{recordDate:{$lte:{$date:"'+b.t2+'"}}}'}}}if(b.hasOwnProperty("f1")&&b.hasOwnProperty("f2")){freqDat=",{minFreq:{$gte:"+b.f1+"}},{maxFreq:{$lte:"+b.f2+"}}"}else{if(b.hasOwnProperty("f1")){freqDat=",{minFreq:{$gte:"+b.f1+"}}"}else{if(b.hasOwnProperty("f2")){freqDat=",{maxFreq:{$lte:"+b.f2+"}}"}else{freqDat=""}}}if(b.hasOwnProperty("dur1")&&b.hasOwnProperty("dur2")){durDat=",{duration:{$gte:"+b.dur1+", $lte:"+b.dur2+"}}"}else{if(b.hasOwnProperty("dur1")){durDat=",{duration:{$gte:"+b.dur1+"}}"}else{if(b.hasOwnProperty("dur2")){durDat=",{duration:{$lte:"+b.dur2+"}}"}else{durDat=""}}}if(b.hasOwnProperty("lnp1")&&b.hasOwnProperty("lnp2")){lnpDat=",{logNoiseProb:{$gte:"+b.lnp1+", $lte:"+b.lnp2+"}}"}else{if(b.hasOwnProperty("lnp1")){lnpDat=",{logNoiseProb:{$gte:"+b.lnp1+"}}"}else{if(b.hasOwnProperty("lnp2")){lnpDat=",{logNoiseProb:{$lte:"+b.lnp2+"}}"}else{lnpDat=""}}}if(b.hasOwnProperty("loc")&&b.hasOwnProperty("rad")){locDat=",{location:{$geoWithin:{$centerSphere:[["+b.loc[1]+","+b.loc[0]+"], "+b.rad/g+"]}}}"}else{locDat=""}if(b.hasOwnProperty("kw")){kwDat=',{$text: {$search:"'+b.kw+'"}}'}else{kwDat=""}postDat="{$and:["+timeDat+freqDat+durDat+lnpDat+locDat+kwDat+"]}";$.ajax({url:"https://acoustic.ifp.uiuc.edu:8081/query?"+a,data:postDat,type:"POST",dataType:"text",timeOut:10000}).done(function(j){file=JSON.parse(j);h(file)}).fail(function(){console.log("ajax fail");f()})};